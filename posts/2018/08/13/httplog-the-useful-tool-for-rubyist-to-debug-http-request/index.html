<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Httplog the Useful Tool for Rubyist to Debug Http Request - YenTing Chen</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Httplog the Useful Tool for Rubyist to Debug Http Request" />
<meta property="og:description" content="Our application introduced “Sharing to Twitter” feature and we did our own integration with Twitter API. We maintained the integration by ourselves because we did not want to introduce too many dependencies. Because of this, we knew a new tool which would be very helpful when debugging outgoing HTTP requests.
It’s not hard to go with modern HTTP gems. Modern HTTP gems, like faraday and typhoeus, provide developers an efficient, imaginable and readable way to organize the outgoing requests." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/2018/08/13/httplog-the-useful-tool-for-rubyist-to-debug-http-request/" />
<meta property="article:published_time" content="2018-08-13T15:13:58&#43;08:00"/>
<meta property="article:modified_time" content="2018-08-13T15:13:58&#43;08:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Httplog the Useful Tool for Rubyist to Debug Http Request"/>
<meta name="twitter:description" content="Our application introduced “Sharing to Twitter” feature and we did our own integration with Twitter API. We maintained the integration by ourselves because we did not want to introduce too many dependencies. Because of this, we knew a new tool which would be very helpful when debugging outgoing HTTP requests.
It’s not hard to go with modern HTTP gems. Modern HTTP gems, like faraday and typhoeus, provide developers an efficient, imaginable and readable way to organize the outgoing requests."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:500,100,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" /><script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script><script src="/js/main.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title">YenTing Chen</h1>
	<div class="site-description"><h2>a.k.a JimYTC</h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/jimytc" title="Github"><i data-feather="github"></i></a><a href="https://twitter.com/jimytc" title="Twitter"><i data-feather="twitter"></i></a><a href="https://www.facebook.com/jim.yenting" title="Facebook"><i data-feather="facebook"></i></a><a href="https://www.linkedin.com/in/yentingchen/" title="LinkedIn"><i data-feather="linkedin"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">Httplog the Useful Tool for Rubyist to Debug Http Request</h1>
			<div class="meta">Posted at &mdash; Aug 13, 2018</div>
		</div>

		<div class="markdown">
			

<p>Our application introduced “Sharing to Twitter” feature and we did our own integration with Twitter API. We maintained the integration by ourselves because we did not want to introduce too many dependencies. Because of this, we knew a new tool which would be very helpful when debugging outgoing HTTP requests.</p>

<h2 id="it-s-not-hard-to-go-with-modern-http-gems">It’s not hard to go with modern HTTP gems.</h2>

<p>Modern HTTP gems, like faraday and typhoeus, provide developers an efficient, imaginable and readable way to organize the outgoing requests. Most of them accept an parameter to enable the verbose logging. For example,</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">require <span style="color:#a31515">&#39;typhoeus&#39;</span>
Typhoeus.get(<span style="color:#a31515">&#34;http://google.com&#34;</span>, <span style="color:#a31515">verbose</span>: <span style="color:#00f">true</span>)</code></pre></div>
<p>However, when we were dealing with our migration task, the issue was not about which parameter to pass for verbose logging. It was that we knew we did something wrong and we wanted to compare the low level log with another working gem to spot the mistake. But we could not control the options used by the gem so we could not get the log. Forking the code was not an option because it was too complicated then.</p>

<p>Fortunately, Ruby community already had the gem, <a href="https://github.com/trusche/httplog"><code>httplog</code></a> for logging the requests to the screen. So let&rsquo;s start to use it. Here are what we did.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#008000"># Add it to Gemfile</span>
gem <span style="color:#a31515">&#39;httplog&#39;</span></code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#008000"># Install the gem</span>
$ bundle install</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#008000"># Configure HttpLog to capture the detail we want to know.</span>

HttpLog.configure <span style="color:#00f">do</span> |config|

  <span style="color:#008000"># Enable or disable all logging</span>
  config.enabled = <span style="color:#00f">true</span>

  <span style="color:#008000"># You can assign a different logger</span>
  config.logger = Logger.new($stdout)

  <span style="color:#008000"># I really wouldn&#39;t change this...</span>
  config.severity = Logger::Severity::DEBUG

  <span style="color:#008000"># Tweak which parts of the HTTP cycle to log...</span>
  config.log_connect   = <span style="color:#00f">true</span>
  config.log_request   = <span style="color:#00f">true</span>
  config.log_headers   = <span style="color:#00f">true</span>
  config.log_data      = <span style="color:#00f">true</span>
  config.log_response  = <span style="color:#00f">false</span>
<span style="color:#00f">end</span></code></pre></div>
<p>That’s it and once we fire the request. You’ll see things like below.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">irb(main):023:0&gt; uri = URI(<span style="color:#a31515">&#39;http://www.google.com&#39;</span>)
=&gt; <span style="color:#008000">#&lt;URI::HTTP http://www.google.com&gt;</span>
irb(main):059:0&gt; Net::HTTP.get(uri)
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.030400 <span style="color:#008000">#19738] DEBUG -- : [httplog] Connecting: www.google.com:80</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.055285 <span style="color:#008000">#19738] DEBUG -- : [httplog] Sending: GET http://www.google.com:80/</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.055377 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: accept-encoding: gzip;q=1.0,deflate;q=0.6,identity;q=0.3</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.055412 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: accept: */*</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.055579 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: user-agent: Ruby</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.055605 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: host: www.google.com</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.055646 <span style="color:#008000">#19738] DEBUG -- : [httplog] Data:</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100233 <span style="color:#008000">#19738] DEBUG -- : [httplog] Status: 200</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100333 <span style="color:#008000">#19738] DEBUG -- : [httplog] Benchmark: 0.044534 seconds</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100388 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: date: Mon, 13 Aug 2018 14:33:30 GMT</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100418 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: expires: -1</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100444 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: cache-control: private, max-age=0</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100468 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: content-type: text/html; charset=ISO-8859-1</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100493 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: p3p: CP=&#34;This is not a P3P policy! See g.co/p3phelp for more info.&#34;</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100519 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: server: gws</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100552 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: content-length: 4737</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100581 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: x-xss-protection: 1; mode=block</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100604 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: x-frame-options: SAMEORIGIN</span>
D, [2018-08-13<span style="color:#a31515">T22</span>:33:30.100630 <span style="color:#008000">#19738] DEBUG -- : [httplog] Header: set-cookie: 1P_JAR=2018-08-13-14; expires=Wed, 12-Sep-2018 14:33:30 GMT; path=/; domain=.google.com, NID=136=NTCQz6wtmZFAJy87eM1aMSbPvW9UVRvSnQVkk5OtJyzIcAtKOmdj2ZFClqZyeURx0VbRdmSIuReGqUE8yCAuExogWjl54i5KfhX0M4LVOb6gDo6f7YJZ4iVXIo2AU9we; expires=Tue, 12-Feb-2019 14:33:30 GMT; path=/; domain=.google.com; HttpOnly</span></code></pre></div>
<p>With <a href="https://github.com/trusche/httplog"><code>httplog</code></a> gem, we finally spot the mistake we made and resolve the issue. Case closed!</p>

<h3 id="many-thanks-to-the-community">Many thanks to the community!</h3>

<h3 id="for-your-information">For your information</h3>

<p>There are more configurations you can use with <a href="https://github.com/trusche/httplog"><code>httplog</code></a>. Please refer to its Github repository from link below for more information.</p>

<p>If you’re curious about posting to twitter, here’s the gem recommended by Twitter and it’s actively maintained, <a href="https://github.com/sferik/twitter"><code>twitter</code></a> gem.</p>

<h2 id="references">References</h2>

<ul>
<li><a href="https://github.com/trusche/httplog">httplog</a></li>
<li><a href="https://github.com/sferik/twitter">twitter</a></li>
<li><a href="https://github.com/typhoeus/typhoeus">typhoeus</a></li>
<li><a href="https://github.com/lostisland/faraday">faraday</a></li>
</ul>

		</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'jimytc-github-io';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
		Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div><a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="gohugo.io">Hugo</a></div>
	</nav>
</div>

</body>
</html>
